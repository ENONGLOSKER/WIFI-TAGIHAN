{% extends "base.html" %} 
{% load static %} 

{% block title %}Bukal Net{% endblock %} 
{% block extra_css %}
<!-- Bootstrap 5 CSS -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  rel="stylesheet" />
<!-- Bootstrap Icons -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
{% endblock %} 


{% block main %}
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
  {% if messages %}
      {% for message in messages %}
          <div class="alert alert-danger py-2" role="alert" style="position: absolute; top: 0; right: 40px; z-index: 999;">
              {{ message }}
          </div>
      {% endfor %}
  {% endif %}
  <div
    class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Dashboard</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
      <button
        type="button"
        class="btn btn-sm btn-outline-secondary dropdown-toggle">
        <i class="bi bi-calendar me-1"></i>
        Bulan Ini
      </button>
    </div>
  </div>
  <!-- Summary Cards -->
  <div class="row mb-4 g-3">
    <div class="col-md-6 col-lg-3">
      <div class="card summary-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted">Pendapatan Bulan Ini</h6>
              <h4 class="card-text">Rp 56,200,000</h4>
              <small class="text-muted">Total Tagihan: Rp 8,310,000</small>
            </div>
            <i class="bi bi-currency-dollar fs-1 text-muted"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="card summary-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted">Aktif</h6>
              <h4 class="card-text">120</h4>
              <small class="text-muted">Sudah bayar</small>
            </div>
            <i class="bi bi-check-circle fs-1 text-muted"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="card summary-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted">Belum Lunas</h6>
              <h4 class="card-text">45</h4>
              <small class="text-muted">Perlu penagihan</small>
            </div>
            <i class="bi bi-exclamation-triangle fs-1 text-muted"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="card summary-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted">Suspend</h6>
              <h4 class="card-text">25</h4>
              <small class="text-muted">Akses ditutup</small>
            </div>
            <i class="bi bi-pause-circle fs-1 text-muted"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row mb-4 g-3">
    <div class="col-md-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header">Pendapatan per Bulan</div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="revenueByMonthChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header">Pendapatan per Lokasi (Sep 2024)</div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="revenueByLocationChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4 g-3">
    <div class="col-md-6 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header">Status Pelanggan</div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="customerStatusChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12 col-lg-8">
      <div class="card shadow-sm">
        <div
          class="card-header d-flex justify-content-between align-items-center">
          <span>Pelanggan Terbaru / Belum Lunas</span>
          <a href="#" class="btn btn-sm btn-outline-secondary">Lihat Semua</a>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover table-sm">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Nama</th>
                  <th scope="col">Lokasi</th>
                  <th scope="col">Paket</th>
                  <th scope="col">Harga</th>
                  <th scope="col">Status</th>
                  <th scope="col">Aksi</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>sakirin sepit</td>
                  <td>Sepit</td>
                  <td>Belum Lunas</td>
                  <td>Rp 0</td>
                  <td>
                    <span class="badge badge-bg-warning">Belum Lunas</span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success">
                      <i class="bi bi-currency-dollar"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>ibu waridah</td>
                  <td>Sepit</td>
                  <td>2 Device</td>
                  <td>Rp 80,000</td>
                  <td><span class="badge badge-bg-success">Aktif</span></td>
                  <td>
                    <button class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success">
                      <i class="bi bi-currency-dollar"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>najwa sepit</td>
                  <td>Sepit</td>
                  <td>Suspend</td>
                  <td>Rp 0</td>
                  <td><span class="badge badge-bg-danger">Suspend</span></td>
                  <td>
                    <button class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success">
                      <i class="bi bi-currency-dollar"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>encu</td>
                  <td>dasan bangket</td>
                  <td>2 Device</td>
                  <td>Rp 80,000</td>
                  <td><span class="badge badge-bg-success">Aktif</span></td>
                  <td>
                    <button class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success">
                      <i class="bi bi-currency-dollar"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>zoya</td>
                  <td>dasan bangket</td>
                  <td>3 Device</td>
                  <td>Rp 100,000</td>
                  <td><span class="badge badge-bg-success">Aktif</span></td>
                  <td>
                    <button class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success">
                      <i class="bi bi-currency-dollar"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %} 


{% block script %}
<!-- Bootstrap 5 JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Grafik Pendapatan per Bulan (Hitam Putih)
  const revenueMonthCtx = document
    .getElementById("revenueByMonthChart")
    .getContext("2d");
  const revenueMonthChart = new Chart(revenueMonthCtx, {
    type: "line",
    data: {
      labels: ["Des 2023", "Mar 2024", "Jun 2024", "Sep 2024"],
      datasets: [
        {
          label: "Pendapatan (Rp)",
          data: [3720000, 6890000, 8310000, 6200000],
          fill: false,
          borderColor: "#212529",
          backgroundColor: "rgba(33, 37, 41, 0.1)",
          tension: 0.1,
          pointBackgroundColor: "#212529",
          pointBorderColor: "#ffffff",
          pointBorderWidth: 2,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: "rgba(0, 0, 0, 0.1)",
          },
          ticks: {
            callback: function (value) {
              return "Rp " + value.toLocaleString("id-ID");
            },
            color: "#212529",
          },
        },
        x: {
          grid: {
            color: "rgba(0, 0, 0, 0.1)",
          },
          ticks: {
            color: "#212529",
          },
        },
      },
      plugins: {
        legend: {
          labels: {
            color: "#212529",
          },
        },
        tooltip: {
          callbacks: {
            label: function (context) {
              let label = context.dataset.label || "";
              if (label) {
                label += ": ";
              }
              if (context.parsed.y !== null) {
                label += new Intl.NumberFormat("id-ID", {
                  style: "currency",
                  currency: "IDR",
                }).format(context.parsed.y);
              }
              return label;
            },
          },
        },
      },
    },
  });

  // Grafik Pendapatan per Lokasi (Hitam Putih)
  const revenueCtx = document
    .getElementById("revenueByLocationChart")
    .getContext("2d");
  const revenueChart = new Chart(revenueCtx, {
    type: "bar",
    data: {
      labels: [
        "Sepit",
        "Monjet",
        "Dasan Bangket",
        "Jangkar",
        "Buwuh",
        "Mtg Waru",
        "Lokon",
        "Setungkep",
      ],
      datasets: [
        {
          label: "Pendapatan (Rp)",
          data: [
            1500000, 800000, 1200000, 900000, 600000, 800000, 700000, 700000,
          ],
          backgroundColor: "#212529",
          borderColor: "#212529",
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: "rgba(0, 0, 0, 0.1)",
          },
          ticks: {
            callback: function (value) {
              return "Rp " + (value / 1000).toLocaleString("id-ID") + "k";
            },
            color: "#212529",
          },
        },
        x: {
          grid: {
            display: false,
          },
          ticks: {
            color: "#212529",
          },
        },
      },
      plugins: {
        legend: {
          display: false,
        },
        tooltip: {
          callbacks: {
            label: function (context) {
              let label = context.dataset.label || "";
              if (label) {
                label += ": ";
              }
              if (context.parsed.y !== null) {
                label += new Intl.NumberFormat("id-ID", {
                  style: "currency",
                  currency: "IDR",
                  maximumFractionDigits: 0,
                }).format(context.parsed.y);
              }
              return label;
            },
          },
        },
      },
    },
  });

  // Grafik Status Pelanggan (Hitam Putih)
  const statusCtx = document
    .getElementById("customerStatusChart")
    .getContext("2d");
  const statusChart = new Chart(statusCtx, {
    type: "doughnut",
    data: {
      labels: ["Aktif", "Belum Lunas", "Suspend"],
      datasets: [
        {
          label: "Jumlah Pelanggan",
          data: [120, 45, 25],
          backgroundColor: ["#000000", "#6c757d", "#212529"],
          borderColor: "#ffffff",
          borderWidth: 2,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: "#212529",
            font: {
              size: 12,
            },
          },
        },
        tooltip: {
          callbacks: {
            label: function (context) {
              const label = context.label || "";
              const value = context.raw || 0;
              return `${label}: ${value} pelanggan`;
            },
          },
        },
      },
    },
  });
</script>
{% endblock %}
